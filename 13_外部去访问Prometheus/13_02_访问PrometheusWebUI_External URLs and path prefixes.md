
说辞 

Prometheus can  serve its web UI on xx url 
Prometheus listens xx url 

This configuration on nginx  would serve Prometheus up on xx URL 
# 1 理论 


When Prometheus is deployed and accessed via its web UI (e.g., the expression browser), it relies on the assumption that the web UI is being accessed directly through the same URL (its root ) where Prometheus is running. This is because Prometheus needs to be able to reference and serve assets like JavaScript, stylesheets, and other resources from its root URL. It also needs to generate links or perform redirects that assume it is at that URL.

----

想要Prometheus能够 always be accessed via it's web UI,  就需要使得他 relies on the assumpotion that 这些 Web UI 是被直接访问的 通过同样的一个 URL.  通常这个 url 是 `localhost:9090/`  `/`  表示 /root URL
Peomerheus 是被假定在在 这个 Url 上面运行的。

为什么 prometheus relies on the assumpotion that 这些 Web UI 是被直接访问的 通过同样的一个 URL? 
prometheus instance 被部署的时候， rometheus would generate  asset URLs which is as root url in default
Prometheus  去 reference and serve the assets 的时候，会使用刚才产生的asset URLs which is its root URL . 。  Prometheus listens this root url, 然后从这个url 上面 take assets such as Javascript 

如果不做任何URL 的特殊配置, Prometheuswill serve its UI assets and handle redirects as if it’s at the root, 
> In short, without the correct URL configuration, Prometheus will serve its UI assets and handle redirects as if it’s at the root, causing issues when it’s actually being accessed at a different URL behind a proxy.

----
部署 prometheus 的时候， prometheus自动生 一些links 或者redirects 。 这些links 和 redirects 都是指向 prometheus it's root url . 
这样有从外部访问的时候， 能够通过这些 links 和 redirect机制 来 使得request 访问导入到 that url where the promethus is running , 进而打开 promethues web ui 和  访问到 promethues restAPI 



# 2 Problem with Reverse Proxy

If Prometheus is placed behind a **reverse proxy**, especially one where Prometheus is not at the root of the URL path (e.g., it’s served at `/prometheus` instead of `/`),. 
This prefixes `/prometheus` are introduced by the reverse proxy

就是说 我们呢要去访问promethues 的时候需要在 `localhost:9090/prometheus`, instead of `localhost:9090/` . prometheus listens on`localhost:9090/prometheus` ， not  `localhost:9090/` anymore 

issues can arise:
1. **Incorrect Asset Paths**: Prometheus still assumes it's being accessed from the root, so when it generates URLs for its assets (like JavaScript files), it might create links that are incorrect or incomplete because the actual URL under the reverse proxy includes a path prefix (e.g., `/prometheus`). As a result, those assets may fail to load, breaking the UI.
    1. 如果不做任何URL 的特殊配置, prometheus serve its UI assets and handle redirects as if it’s at the root。 prometheus 会产生root-based URLs for its assets \
    2. 但是事实上 Prometheus is placed behind a **reverse proxy** and serves at `/prometheus` instead of `/`
    3. By setting the `--web.route-prefix` flag or `--web.external-url` , you can ensure that all Prometheus assets (e.g., CSS, JavaScript) and API routes are correctly referenced relative to the reverse proxy’s path
    
2. **Incorrect Redirects**: Similarly, any redirects or links generated by Prometheus (e.g., when navigating the UI) will **not include the necessary URL path prefixes that are introduced by the reverse proxy**. This could lead to broken navigation or inability to access specific UI features.
    1. Prometheus 产生的  redirects or links  也不包括 这个prefix in this path 



# 3 Solutions:  flag `--web.external-url`  and  `--web.route-prefix` in prometheus


The `--web.route-prefix` and `--web.external-url`  flag in Prometheus is useful for configuring Prometheus to serve its web UI and API from a specific URL path, especially when working behind reverse proxies or serving Prometheus from a sub-path. It helps ensure that all routes, links, and assets are correctly generated and accessible under the desired URL structure.

routePrefix: 
- Prefix used to register routes, ==overriding externalUrl route==. Useful for proxies that rewrite URLs.
externalUrl: 
- External URL at which Prometheus will be reachable. 
- If you’re using the `--web.route-prefix` flag, you often need to pair it with the `--web.external-url` flag to ensure that Prometheus ==generates proper absolute URLs for external access,== especially when links or redirects are involved.
- `prometheus --web.route-prefix=/prometheus --web.external-url=https://example.com/prometheus`


>  By setting the `--web.route-prefix` flag or `--web.external-url` , you can ensure that all Prometheus assets (e.g., CSS, JavaScript) and API routes are correctly referenced relative to the reverse proxy’s path。 This flag is particularly useful when you are running Prometheus behind a reverse proxy or serving it from a sub-path (instead of the root `/` path).

1 
**Setting  flag `--web.external-url`** in prometheus: One way to address this issue is to configure Prometheus with the `--web.external-url` flag. This tells Prometheus what the full external URL is, including any path prefixes added by the reverse proxy. Prometheus will then correctly generate asset paths and links.

`--web.external-url` 的值 就是in which path with  which prefix the prometheus is placed behind a reverse proxy 


2
**Prefixing the Web UI and API Routes**:  
When Prometheus is served behind a reverse proxy and you want to access it from a path like `/prometheus` (instead of the root `/`), you can set the `--web.route-prefix` flag to `/prometheus`. This will ensure that all Prometheus web routes (like `/graph`, `/status`, `/targets`, etc.) are prefixed with `/prometheus`, making it accessible through the desired sub-path.

`prometheus --web.route-prefix=/prometheus`

This will make Prometheus available at URLs like:
- `/prometheus/graph`
- `/prometheus/status`
- `/prometheus/targets`


3
**Working with Reverse Proxies**:  
When Prometheus is deployed behind a reverse proxy, it often doesn’t serve content from the root path `/`. By setting the `--web.route-prefix` flag, you can ensure that all Prometheus assets (e.g., CSS, JavaScript) and API routes are correctly referenced relative to the reverse proxy’s path. Without the correct route prefix, Prometheus would generate incorrect asset URLs, breaking the web UI.

Proper configuration of the reverse proxy can also help. You would need to ensure that the proxy is correctly forwarding requests and rewriting paths if necessary, so that Prometheus can still serve its web UI as expected.
    - 在 Reverse Proxy中也要 相当的配置， 



## 3.1 Common Use Cases
- **Reverse Proxy Setup**: When using Prometheus behind a reverse proxy like NGINX or Apache, if Prometheus is not served from the root URL, you can use this flag to align the internal routing.
- **Multiple Prometheus Instances**: If you are running multiple Prometheus instances on the same server, you might want to distinguish them by different prefixes. Each instance can be served under its own path.
## 3.2 例子 
https://www.robustperception.io/using-external-urls-and-proxies-with-prometheus/


### 3.2.1 How It Works 很重要

- When a client sends a request to NGINX with `http://yourdomain.com/prometheus/`, or `http://yourdomain.com:9090/prometheus/` or `http://yourdomain.com:19090/prometheus/`  
    -  如果这个路径 是从nginx 对应的某一个 configuration  的 `listen 0.0.0.0:19090;` and `location /prometheus/ ` 推到出来的
        - 需要将--web.external-url 设置成 `19090:/prometheus/`
    -  如果这个路径 是从nginx 对应的某一个 configuration   `listen 0.0.0.0:9090;` and `location /prometheus/ ` 推到出来的
        - 需要将--web.external-url 设置成 `9090:/prometheus/` 或者 直接省略 9090  ， 写为`/prometheus/` ， 因为 9090prometheus默认的dafult port
- NGINX then matches the request against the `location /prometheus/` block and forwards it to `http://localhost:9090/prometheus/`  or `http://localhost:9090/` using the `proxy_pass` directive.
    - 如果 `proxy_pass :9090/prometheus/`, 则需要`--web.route-url=/prometheus/`
    - 如果 `proxy_pass :9090/prometheus-yzh/`, 则需要 `--web.route-url=/prometheus-yzh/
    -  如果 `proxy_pass :9090/`, 则需要 `--web.route-url=/
-  然后  Prometheus receives the request on its default port `9090`, 就可以正确的 使用 access 正确的route了。 the correct route is accessed.

### 3.2.2 configuration in nginx 

 Nginx installed with the following configuration:
```
 http {
 server {
   listen 0.0.0.0:19090;  或者也可以写为 9090 这样就使用的是 prometheus defautl port ;
   location /prometheus/ {
     proxy_pass :9090/;    或者也可以写为 9090/prometheus/;
     proxy_set_header Host $host;
   }
 }
}
events {
}
```

This NGINX configuration snippet sets up a reverse proxy for Prometheus, routing requests through the `/prometheus/` path.
the reverse proxy now listens on port **19090**, while still forwarding requests to Prometheus running on port **9090**.
1 
`http {}` Block
The `http` block defines configurations for HTTP-related services in NGINX. Inside this block, there are server configurations that manage how incoming HTTP requests are handled.

2 
`server {}` Block

2.1 
`listen 0.0.0.0:19090;`
- **`listen`**: This directive tells NGINX to listen on a specific IP address and port.
- **`0.0.0.0:19090`**:
    - `0.0.0.0` means that NGINX will listen on all available network interfaces.
    - `19090` is the port number on which NGINX will accept incoming requests.

So now, NGINX is set to listen on **port 19090** instead of the default port **9090**. This allows you to access the Prometheus web UI via NGINX on a different port, like `http://yourdomain.com:19090/prometheus/`.

如果是 
`listen 0.0.0.0:9090;`
- **`listen`**: This directive tells NGINX to listen on a specific IP address and port.
- **`0.0.0.0:9090`**:
    - `0.0.0.0` means that NGINX will listen on all available network interfaces.
    - `9090` is the port number on which NGINX will accept incoming requests.

So now, NGINX is set to listen on **port 9090** ， is the default prometheus port **9090**. This allows you to access the Prometheus web UI via NGINX on a default port, like `http://yourdomain.com:9090/prometheus/`. ==或者可以直接省略 9090 ， 改为访问 `http://yourdomain.co/prometheus/`.  也行==


2.2
`location /prometheus/ { ... }`
- **`location /prometheus/`**: This block applies to requests that match the path `/prometheus/`. Any request to a URL like `http://yourdomain.com:19090/prometheus/graph` will be matched.


2.3 
`proxy_pass :9090/;`
- **`proxy_pass`**: This directive forwards the incoming request to another server.
- **`:9090/`**:
    - `:9090` refers to the localhost running Prometheus on port **9090**， which is the default port where Prometheus runs.
    - `/` specifies the path on the Prometheus server. it is the path where Prometheus expects to receive requests (assuming Prometheus has been configured with the `--web.route-prefix=/ flag).
    - `/prometheus/` is the path where Prometheus expects to receive requests (assuming Prometheus has been configured with the `--web.route-prefix=/prometheus` flag

So, when a request comes to 
- `http://yourdomain.com：19090/prometheus/`, if `listen 0.0.0.0:19090;`, 
- `http://yourdomain.com：9090/prometheus/`, or  `http://yourdomain.com/prometheus/`, if `listen 0.0.0.0:9090;`, 
NGINX forwards it to `http://localhost:9090/` where Prometheus is listening.


或者写为 
`proxy_pass :9090/prometheus/;`
- **`proxy_pass`**: This directive tells NGINX to forward incoming requests to another server (or service). In this case, it forwards the requests to Prometheus.
- **`:9090/prometheus/`**:
    - `:9090` refers to the **localhost** on port **9090**, which is the default port where Prometheus runs.
    - `/prometheus/` is the path where Prometheus expects to receive requests (assuming Prometheus has been configured with the `--web.route-prefix=/prometheus` flag).

So, when a request comes to 
- `http://yourdomain.com：19090/prometheus/`, if `listen 0.0.0.0:19090;`, 
- `http://yourdomain.com：9090/prometheus/`, or  `http://yourdomain.com/prometheus/`, if `listen 0.0.0.0:9090;`, 
NGINX forwards it to `http://localhost:9090/prometheus/` where Prometheus is running.


2.4 
`events {}` Block
The `events` block is typically used to define global settings related to the handling of network connections, such as the maximum number of simultaneous connections. In this case, it is empty, which means NGINX will use default settings for connection handling.

2.5 
This configuration on nginx  would serve Prometheus up on` :9090/prometheus/` and Nginx will include the /prometheus/ prefix when passing on requests to Prometheus. 

To make this work you'd need to run Prometheus like: `prometheus --web.external-url :9090/prometheus/`

You should be aware that with this external URL, the /prometheus/ path prefix will be required for all HTTP access to Prometheus. The /metrics will be on` :9090/prometheus/metrics` for example.



### 3.2.3 Missing `http://` in `proxy_pass`

It’s important to note that the `proxy_pass :9090/prometheus/;` directive is missing the `http://` scheme. In most cases, you should specify the scheme (`http://` or `https://`) for clarity:

`proxy_pass http://localhost:9090/prometheus/;`

Without it, NGINX might not handle the request properly, as it defaults to protocol-relative URLs, which can cause issues.


## 3.3 重要: 什么时候只需要设置 --web.external-url 的值 ，不需要 设置 --web.route-prefix的值了
https://www.robustperception.io/using-external-urls-and-proxies-with-prometheus/
https://www.robustperception.io/external-urls-and-path-prefixes/

1 只需要 给出--web.external-url 的值， **不需要 设置 --web.route-prefix的值了** 的情况
当 user 使用`http://yourdomain.com:xxxx/prometheus/` 去访问 nginx 这个reverse proxy. 这里必须要写为 `http://yourdomain.com:xxxx/prometheus/`， 不能写为 `http://yourdomain.com:xxxx/prometheus-xyz/` 因为 对应的 configuration in nginx 中 写为了` location /prometheus/ {}`
通过 对应的 configuration in nginx 中的 proxy_pass 中 定义的地址，比如说这个地址为 `proxy_pass :9090/prometheus/;`    
则这时候  `proxy_pass :9090/prometheus/;` 中的 prefix name 的value 为 prometheus 和 `http://yourdomain.com:xxxx/prometheus/`中的 prefix name 的value 为 prometheus)， 这两个value 是相同的。 
则 nginx 会将 这个request redirect 到  相同的 prefix name  中去 ， 则只需要 给出--web.external-url = `9090/prometheus/`， **不需要 设置 --web.route-prefix的值了**
因为 By default Prometheus (and Alertmanager) presumes that any path in the external URL is a prefix path that'll be in all requests that are sent to it.

例子
```
http {
 server {
   listen 0.0.0.0:19090;
   location /prometheus/ {
     proxy_pass :9090/prometheus/;
   }
 }
}
events {
}
```

This configuration would serve Prometheus up on [:19090/prometheus/](https://www.robustperception.io/using-external-urls-and-proxies-with-prometheus/:19090/prometheus/), and Nginx will include the `/prometheus/` prefix when passing on requests to Prometheus. To make this work you'd need to run Prometheus like: 
`prometheus --web.external-url :19090/prometheus/`

2 需要 给出--web.external-url 的值，也必须设置 --web.route-prefix的值
当 user 使用`http://yourdomain.com:xxxx/prometheus/` 去访问 nginx 这个reverse proxy， 这里必须要写为 `http://yourdomain.com:xxxx/prometheus/`， 不能写为 `http://yourdomain.com:xxxx/prometheus-xyz/` 因为 对应的 configuration in nginx 中 写为了 `location /prometheus/ {}`
通过 对应的 configuration in nginx 中的 proxy_pass 中 定义的地址，比如说这个地址为 proxy_pass   `proxy_pass :9090/;` 或者     `proxy_pass :9090/xyz;`   

则这时候  `proxy_pass :9090/;` 或者    `proxy_pass :9090/xyz/;` 中的 prefix name (/ 或者 xyz) 和 `http://yourdomain.com:xxxx/prometheus/`中的 prefix name (prometheus) 是不相同的。 

则 nginx 会将 这个request redirect 到 不相同的 prefix name  中去 . 在这种情况修啊，则不光要给出`--web.external-url = 9090/prometheus/`的值，还必须需要 设置 --web.route-prefix=`/` or `/xyz` 的值。
因为 By default Prometheus (and Alertmanager) presumes that any path in the external URL is a prefix path that'll be in all requests that are sent to it.

例子
```
http {
 server {
   listen 0.0.0.0:19090;
   location /prometheus/ {
     proxy_pass :9090/;  # 
   }
 }
}
events {
}
```

==Unlike the example in the [previous post](https://www.robustperception.io/using-external-urls-and-proxies-with-prometheus/), this will strip off the `/prometheus/` before passing on requests to Prometheus.== In this case you need to specify the URL the user is using in their browser, and also that the prefix Prometheus will see in it's HTTP requests is not `/prometheus/` but rather just the empty `/`:

`prometheus --web.external-url :19090/prometheus/ --web.route-prefix=/`

As before, Prometheus will also be accessible on [:19090/prometheus/](https://www.robustperception.io/external-urls-and-path-prefixes/:19090/prometheus/). same as like the last example 



### 3.3.1 用来佐证上面的的例子 

https://groups.google.com/g/prometheus-users/c/P8rdW1g3Tgo?pli=1
> 这个bug 是2017 年的， 已经被解决了， bug 不存在了 

I am trying to set up prometheus (2.0.0-beta1) behind a simple Apache reverse proxy, which is not changing the path:
        ProxyPass /prometheus http://10.85.179.50:9090/prometheus
        ProxyPassReverse /prometheus http://10.85.179.50:9090/prometheus

My problem is setting up prometheus to work with this prefix, and I'm unclear on the purpose of the two separate settings.

(1) If I set both
--web.external-url=https://example.com/prometheus
--web.route-prefix=/prometheus

then I end up with a double redirect to /prometheus/prometheus/graph which then gives a 404 (details below).

(1a) If I set only
--web.external-url=https://example.com/prometheus

then I get the same behaviour. (Aside: this seems to be expected, given that ./prometheus --help says that web.route_prefix "Defaults to path of --web.external-url.")

(2) If I set
--web.external-url=https://example.com/prometheus
--web.route-prefix=/

then the server does not respond on /prometheus, but does respond on /graph

(3) If I set
--web.external-url=https://example.com/
--web.route-prefix=/prometheus

then /prometheus/graph responds as expected; however all the embedded CSS and action links are absolute links against /, not /prometheus.

(3a) If I set only
--web.route-prefix=/prometheus

then I get identical result to case (3).  Aside: the string "https://example.com/" doesn't seem to appear anywhere in the output, so I don't see what difference --web.external-url makes anyway.


# 4 flag `--web.external-url`  and  `--web.route-prefix` 的值 in values.yaml in helm-chart kube-prometheus-stack 中的给出 

routePrefix: 
- Prefix used to register routes, ==overriding externalUrl route==. Useful for proxies that rewrite URLs.
externalUrl: 
- External URL at which Prometheus will be reachable. 
- If you’re using the `--web.route-prefix` flag, you often need to pair it with the `--web.external-url` flag to ensure that Prometheus ==generates proper absolute URLs for external access,== especially when links or redirects are involved.

- `prometheus --web.route-prefix=/prometheus --web.external-url=https://example.com/prometheus`

## 4.1 

```yaml
prometheus:
  prometheusSpec:
    externalUrl: /prometheus-lzm-yzh
    routePrefix: /prometheus-lzm


  ingress:
    enabled: true
    ingressClassName: haproxy
    hosts:
      - ""
    path: /prometheus-lzm
```


这时候后 生成的 lzm-prometheus 这个 ingess 中的 rule 为 
```
Name:             lzm-prometheus
Labels:           app=kube-prometheus-stack-prometheus
                  app.kubernetes.io/instance=prom-lzm
                  app.kubernetes.io/managed-by=Helm
                  app.kubernetes.io/part-of=kube-prometheus-stack
                  app.kubernetes.io/version=62.2.1
                  chart=kube-prometheus-stack-62.2.1
                  heritage=Helm
                  release=prom-lzm
Namespace:        prom-lzm
Address:          
Ingress Class:    haproxy
Default backend:  <default>
Rules:
  Host        Path  Backends
  ----        ----  --------
  *           
              /prometheus-lzm   lzm-prometheus:9090 (100.64.51.91:9090)
Annotations:  <none>
Events:
  Type    Reason  Age                  From                Message
  ----    ------  ----                 ----                -------
  Normal  CREATE  48m                  ingress-controller  Ingress prom-lzm/lzm-prometheus
  Normal  UPDATE  4m10s (x4 over 47m)  ingress-controller  Ingress prom-lzm/lzm-prometheus

```

浏览器中 输入 xx/prometheus-lzm  会自动 跳转到 /prometheus-lzm-yzh， 但是仍然没办法打开web ui 


## 4.2 


```yaml
prometheus:
  prometheusSpec:
    externalUrl: /prometheus-lzm-yzh
    routePrefix: /prometheus-lzm-yzh


  ingress:
    enabled: true
    ingressClassName: haproxy
    hosts:
      - ""
    path: /prometheus-lzm
```


这时候后 生成的 lzm-prometheus 这个 ingess 中的 rule 为 
```
Name:             lzm-prometheus
Labels:           app=kube-prometheus-stack-prometheus
                  app.kubernetes.io/instance=prom-lzm
                  app.kubernetes.io/managed-by=Helm
                  app.kubernetes.io/part-of=kube-prometheus-stack
                  app.kubernetes.io/version=62.2.1
                  chart=kube-prometheus-stack-62.2.1
                  heritage=Helm
                  release=prom-lzm
Namespace:        prom-lzm
Address:          
Ingress Class:    haproxy
Default backend:  <default>
Rules:
  Host        Path  Backends
  ----        ----  --------
  *           
              /prometheus-lzm-yzh   lzm-prometheus:9090 (100.64.51.91:9090)
Annotations:  <none>
Events:
  Type    Reason  Age                  From                Message
  ----    ------  ----                 ----                -------
  Normal  CREATE  48m                  ingress-controller  Ingress prom-lzm/lzm-prometheus
  Normal  UPDATE  4m10s (x4 over 47m)  ingress-controller  Ingress prom-lzm/lzm-prometheus

```

浏览器中 输入 xx/prometheus-lzm  无效
输入 xx/prometheus-lzm-yzh 是有效的  能打开打开web ui 


## 4.3 


```yaml
prometheus:
  prometheusSpec:
    externalUrl: /prometheus-lzm
    routePrefix: /prometheus-lzm-yzh

  ingress:
    enabled: true
    ingressClassName: haproxy
    hosts:
      - ""
    path: /prometheus-lzm
```


这时候后  生成的 lzm-prometheus 这个 ingess 中的 rule 为 
```
Name:             lzm-prometheus
Labels:           app=kube-prometheus-stack-prometheus
                  app.kubernetes.io/instance=prom-lzm
                  app.kubernetes.io/managed-by=Helm
                  app.kubernetes.io/part-of=kube-prometheus-stack
                  app.kubernetes.io/version=62.2.1
                  chart=kube-prometheus-stack-62.2.1
                  heritage=Helm
                  release=prom-lzm
Namespace:        prom-lzm
Address:          
Ingress Class:    haproxy
Default backend:  <default>
Rules:
  Host        Path  Backends
  ----        ----  --------
  *           
              /prometheus-lzm-yzh   lzm-prometheus:9090 (100.64.51.91:9090)
Annotations:  <none>
Events:
  Type    Reason  Age                  From                Message
  ----    ------  ----                 ----                -------
  Normal  CREATE  48m                  ingress-controller  Ingress prom-lzm/lzm-prometheus
  Normal  UPDATE  4m10s (x4 over 47m)  ingress-controller  Ingress prom-lzm/lzm-prometheus

```

浏览器中 输入 xx/prometheus-lzm  无效 
输入 xx/prometheus-lzm-yzh 会跳转到  xx/prometheus-lzm ， 但是 仍能打开打开web ui 

## 4.4 正确的给出方法
```yaml
prometheus:
  prometheusSpec:
    externalUrl: /prometheus-lzm
    routePrefix: /prometheus-lzm 


  ingress:
    enabled: true
    ingressClassName: haproxy
    hosts:
      - ""
    path: /prometheus-lzm-yzh
```


这时候后  生成的 lzm-prometheus 这个 ingess 中的 rule 为 
```
Name:             lzm-prometheus
Labels:           app=kube-prometheus-stack-prometheus
                  app.kubernetes.io/instance=prom-lzm
                  app.kubernetes.io/managed-by=Helm
                  app.kubernetes.io/part-of=kube-prometheus-stack
                  app.kubernetes.io/version=62.2.1
                  chart=kube-prometheus-stack-62.2.1
                  heritage=Helm
                  release=prom-lzm
Namespace:        prom-lzm
Address:          
Ingress Class:    haproxy
Default backend:  <default>
Rules:
  Host        Path  Backends
  ----        ----  --------
  *           
              /prometheus-lzm   lzm-prometheus:9090 (100.64.51.91:9090)
Annotations:  <none>
Events:
  Type    Reason  Age                  From                Message
  ----    ------  ----                 ----                -------
  Normal  CREATE  48m                  ingress-controller  Ingress prom-lzm/lzm-prometheus
  Normal  UPDATE  4m10s (x4 over 47m)  ingress-controller  Ingress prom-lzm/lzm-prometheus

```


上面的相当于
  `prometheus --web.route-prefix=/prometheus-lzm --web.external-url=https://example.com/prometheus-lzm
   加上
   nginx 中如此配置
```
 server {
   location /prometheus-lzm/ {
     proxy_pass :9090/prometheus-lzm ;  # 
   }
 }
```

prometheus.ingress.path=prometheus-lzm-yzh 的效果是 如果 想要从外部访问 nginx controller ， 再使得nginx controller redirect the request into promehteus, 。 则需要再brauwser 给出 https://example.com/prometheus-lzm 去访问nginx controller 。 
而且因为 prometheus.ingress.path=prometheus-lzm， 所以 prometheus.prometheusSpec.externalUrl 也必须等于prometheus-lzm

而且 prothmous 默认是 that the web UI is being accessed directly through the its root  URL where Prometheus is running. This is because Prometheus needs to be able to reference and serve assets like JavaScript, stylesheets, and other resources from its root 
但是 prometheus 其实是部署在了 /prometheus-lzm  这个 prefix 之下了
所以  prometheus.prometheusSpec.externalUrl 也必须等于 /prometheus-lzm . 
